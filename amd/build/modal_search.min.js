define(["jquery","core/notification","core/custom_interaction_events","core/modal","core/templates","core/modal_registry"],function(n,o,e,r,t,i){var s="#selectModalSource",a="#inputModalSearch",c='[data-action="search"]',d="[data-action='content_block']",l=".modal-content";function p(t){r.call(this,t),this.getBody().find(s).length||o.exception({message:"No select source"}),this.getBody().find(a).length||o.exception({message:"No input search box"})}return p.TYPE="mod_jirbis-search",((p.prototype=Object.create(r.prototype)).constructor=p).prototype.course=void 0,p.prototype.registerEventListeners=function(t){r.prototype.registerEventListeners.call(this),this.getModal().on(e.events.activate,c,function(t,e){console.log(t,e),void 0===p.prototype.course&&o.exception({message:"Не передан идентификатор курса"});let r=this.getBody();e={id:p.prototype.course,limit:10,source:r.find(s).val(),query:r.find(a).val().trim()};e.source&&0!==e.source.length?e.query&&0!==e.query.length?n.ajax({type:"POST",url:"/mod/jirbis/api/index.php?"+n.param(e),beforeSend:function(){r.find(d).empty(),r.closest(l).addClass("loading")},success:function(e){if(0===e.data.length)r.find(d).html('<tr><td colspan="3">Не найдено</td></tr>');else for(let t=0;t<e.data.length;t++){var o=n(`<tr><td>${e.data[t].name}</td><td>${e.data[t].url}</td><td><button>Добавить</button></td></tr>`);r.find(d).append(o)}},error:function(t){o.exception(t)},complete:function(){r.closest(l).removeClass("loading")}}):o.alert("Ошибка","Поле поиска не может бюыть пустым"):o.alert("Ошибка","Поле источник не может бюыть пустым")}.bind(this))},p.prototype.setCourse=function(t){p.prototype.course=t},i.register(p.TYPE,p,"mod_jirbis/modal_search"),p});